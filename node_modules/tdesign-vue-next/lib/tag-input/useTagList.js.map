{"version":3,"file":"useTagList.js","sources":["../../src/tag-input/useTagList.tsx"],"sourcesContent":["import { ref, toRefs } from 'vue';\nimport { TagInputValue, TagInputChangeContext } from './type';\nimport { TagInputProps } from './interface';\nimport { InputValue } from '../input';\nimport Tag from '../tag';\nimport useVModel from '../hooks/useVModel';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX } from '../hooks/tnode';\n\nexport type ChangeParams = [TagInputChangeContext];\n\n// handle tag add and remove\nexport default function useTagList(props: TagInputProps) {\n  const renderTNode = useTNodeJSX();\n  const classPrefix = usePrefixClass();\n  const { value, modelValue, onRemove, max, minCollapsedNum, size, disabled, readonly, tagProps, getDragProps } =\n    toRefs(props);\n  // handle controlled property and uncontrolled property\n  const [tagValue, setTagValue] = useVModel(value, modelValue, props.defaultValue || [], props.onChange);\n  const oldInputValue = ref<InputValue>();\n\n  // 点击标签关闭按钮，删除标签\n  const onClose = (p: { e?: MouseEvent; index: number; item: string | number }) => {\n    const arr = [...tagValue.value];\n    arr.splice(p.index, 1);\n    setTagValue(arr, { trigger: 'tag-remove', ...p });\n    onRemove.value?.({ ...p, trigger: 'tag-remove', value: arr });\n  };\n\n  const clearAll = (context: { e: MouseEvent }) => {\n    setTagValue([], { trigger: 'clear', e: context.e });\n  };\n\n  // 按下 Enter 键，新增标签\n  const onInnerEnter = (value: string, context: { e: KeyboardEvent }) => {\n    const valueStr = value ? String(value).trim() : '';\n    const isLimitExceeded = max && tagValue.value?.length >= max.value;\n    let newValue: TagInputValue = tagValue.value;\n    if (!isLimitExceeded && valueStr) {\n      newValue = tagValue.value instanceof Array ? tagValue.value.concat(String(valueStr)) : [valueStr];\n      setTagValue(newValue, {\n        trigger: 'enter',\n        index: newValue.length - 1,\n        item: valueStr,\n        e: context.e,\n      });\n    }\n    props?.onEnter?.(newValue, { ...context, inputValue: value });\n  };\n\n  // 按下回退键，删除标签\n  const onInputBackspaceKeyUp = (value: InputValue) => {\n    if (!tagValue.value || !tagValue.value.length) return;\n    oldInputValue.value = value;\n  };\n  // 按下回退键，删除标签\n  const onInputBackspaceKeyDown = (value: InputValue, context: { e: KeyboardEvent }) => {\n    const { e } = context;\n    if (!tagValue.value || !tagValue.value.length || e.key === 'Process') return;\n    // 回车键删除，输入框值为空时，才允许 Backspace 删除标签\n    const isDelete = /(Backspace|NumpadDelete)/i.test(e.code) || /(Backspace|NumpadDelete)/i.test(e.key);\n    if (!value && isDelete) {\n      const index = tagValue.value.length - 1;\n      const item = tagValue.value[index];\n      const trigger = 'backspace';\n      const newValue = tagValue.value.slice(0, -1);\n      setTagValue(newValue, { e, index, item, trigger });\n      onRemove.value?.({ e, index, item, trigger, value: newValue });\n    }\n    oldInputValue.value = value;\n  };\n\n  const renderLabel = ({ displayNode, label }: { displayNode: any; label: any }) => {\n    const newList = minCollapsedNum.value ? tagValue.value.slice(0, minCollapsedNum.value) : tagValue.value;\n    const list = displayNode\n      ? [displayNode]\n      : newList?.map?.((item, index) => {\n          const tagContent = renderTNode('tag', { params: { value: item } });\n          return (\n            <Tag\n              key={`${item}${index}`}\n              size={size.value}\n              disabled={disabled.value}\n              onClose={(context: { e: MouseEvent }) => onClose({ e: context.e, item, index })}\n              closable={!readonly.value && !disabled.value}\n              {...getDragProps.value?.(index, item)}\n              {...tagProps.value}\n            >\n              {tagContent ?? item}\n            </Tag>\n          );\n        }) || [];\n    if (![null, undefined, ''].includes(label)) {\n      list.unshift(\n        <div class={`${classPrefix.value}-tag-input__prefix`} key=\"label\">\n          {label}\n        </div>,\n      );\n    }\n    // 超出省略\n    if (newList.length !== (tagValue.value || []).length) {\n      const len = tagValue.value.length - newList.length;\n      const more = renderTNode('collapsedItems', {\n        params: {\n          value: tagValue.value,\n          count: tagValue.value.length - minCollapsedNum.value,\n          collapsedTags: tagValue.value.slice(minCollapsedNum.value, tagValue.value.length),\n          collapsedSelectedItems: tagValue.value.slice(minCollapsedNum.value, tagValue.value.length),\n        },\n      });\n      list.push(\n        more ?? (\n          <Tag key=\"more\" size={size.value}>\n            +{len}\n          </Tag>\n        ),\n      );\n    }\n    return list;\n  };\n\n  return {\n    tagValue,\n    clearAll,\n    onClose,\n    onInnerEnter,\n    onInputBackspaceKeyUp,\n    onInputBackspaceKeyDown,\n    renderLabel,\n  };\n}\n"],"names":["useTagList","props","renderTNode","useTNodeJSX","classPrefix","usePrefixClass","_toRefs","toRefs","value","modelValue","onRemove","max","minCollapsedNum","size","disabled","readonly","tagProps","getDragProps","_useVModel","useVModel","defaultValue","onChange","_useVModel2","_slicedToArray","tagValue","setTagValue","oldInputValue","ref","onClose","p","_onRemove$value","arr","_toConsumableArray","splice","index","trigger","call","_objectSpread","clearAll","context","e","onInnerEnter","_tagValue$value","_props$onEnter","valueStr","String","trim","isLimitExceeded","length","newValue","Array","concat","item","onEnter","inputValue","onInputBackspaceKeyUp","onInputBackspaceKeyDown","key","isDelete","test","code","_onRemove$value2","slice","renderLabel","_ref","_newList$map","displayNode","label","newList","list","map","_getDragProps$value","tagContent","params","_createVNode","Tag","_mergeProps","_default","includes","unshift","len","more","count","collapsedTags","collapsedSelectedItems","push"],"mappings":"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"}