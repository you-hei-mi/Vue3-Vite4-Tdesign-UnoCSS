{"version":3,"file":"plugin.js","sources":["../../src/loading/plugin.tsx"],"sourcesContent":["import { App, Plugin, createApp, defineComponent, h, reactive } from 'vue';\nimport LoadingComponent from './loading';\nimport { getAttach, removeClass, addClass } from '../utils/dom';\nimport { TdLoadingProps, LoadingInstance, LoadingMethod } from './type';\nimport { usePrefixClass } from '../hooks/useConfig';\n\nlet fullScreenLoadingInstance: LoadingInstance = null;\n\nfunction createLoading(props: TdLoadingProps): LoadingInstance {\n  const component = defineComponent({\n    setup() {\n      const loadingOptions = reactive(props);\n      return {\n        loadingOptions,\n      };\n    },\n    render() {\n      return h(LoadingComponent, {\n        ...this.loadingOptions,\n      });\n    },\n  });\n\n  const attach = getAttach(props.attach);\n\n  const app = createApp(component);\n  const loading = app.mount(document.createElement('div'));\n  const parentRelativeClass = usePrefixClass('loading__parent--relative').value;\n  const prefixClass = usePrefixClass('loading');\n\n  if (attach) {\n    addClass(attach, parentRelativeClass);\n  } else {\n    console.error('attach is not exist');\n  }\n\n  const loadingInstance: LoadingInstance = {\n    hide: () => {\n      loading.loading = false;\n      attach.querySelectorAll(`.${prefixClass.value}`)?.forEach((item) => {\n        item.remove();\n      });\n      removeClass(attach, parentRelativeClass);\n      app.unmount();\n    },\n  };\n  return loadingInstance;\n}\n\nfunction produceLoading(props: boolean | TdLoadingProps): LoadingInstance {\n  const lockClass = usePrefixClass('loading--lock');\n\n  // 全屏加载\n  if (props === true) {\n    fullScreenLoadingInstance = createLoading({\n      fullscreen: true,\n      loading: true,\n      attach: 'body',\n    });\n    return fullScreenLoadingInstance;\n  }\n  removeClass(document.body, lockClass.value);\n\n  if (props === false) {\n    // 销毁全屏实例\n    removeClass(document.body, lockClass.value);\n    fullScreenLoadingInstance.hide();\n    fullScreenLoadingInstance = null;\n    return;\n  }\n  return createLoading(props);\n}\n\nexport type LoadingPluginType = Plugin & LoadingMethod;\n\nconst LoadingPlugin: LoadingPluginType = produceLoading as LoadingPluginType;\n\nLoadingPlugin.install = (app: App) => {\n  // eslint-disable-next-line no-param-reassign\n  app.config.globalProperties.$loading = produceLoading;\n};\n\nexport default LoadingPlugin;\n"],"names":["fullScreenLoadingInstance","createLoading","props","component","defineComponent","setup","loadingOptions","reactive","render","h","LoadingComponent","_objectSpread","attach","getAttach","app","createApp","loading","mount","document","createElement","parentRelativeClass","usePrefixClass","value","prefixClass","addClass","console","error","loadingInstance","hide","_attach$querySelector","querySelectorAll","forEach","item","remove","removeClass","unmount","produceLoading","lockClass","fullscreen","body","LoadingPlugin","install","config","globalProperties","$loading"],"mappings":"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"}